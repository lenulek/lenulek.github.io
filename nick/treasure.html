<!DOCTYPE  html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Найди клад!</title>
</head>

<body>
	<h1 id="heading">Найди клад!</h1>

	<!--страницa игры с картинкой (картой сокровищ) [400x400] и местом, куда будут выводиться сообщения для игрокa-->

	<img id="map" width=800 height=800
		src="http://nostarch.com/images/treasuremap.png">

	<p id="distance"></p> <!--B этот элемент мы будем с помощью JavaScript выводить текст подсказок, сообщающих игроку, насколько он близок к цели.-->

	<script src="https://code.jquery.com/jquery-2.1.0.js"></script>

	<script>
		// Здесь будет код игры

		//Выбрать на карте случайную точку, где спрятан клад.
		//Подсказка: Поскольку размер карты 400 × 400 пикселей, координаты ее верхнего левого угла равны { x: 0, y: 0 }, а координаты нижнего правого угла — { x: 399, y: 399 }. Чтобы указать на карте сокровищ случайную точку, нам нужно выбрать случайное значение в диапазоне от 0 до 399 для координаты x и случайное значение в том же диапазоне для координаты y.

		//напишем функцию, которая принимает размер в качестве аргумента и возвращает случайное число от 0 до этого размера (но не включая его) -- or Получить случайное число от 0 до size-1:
		var getRandomNumber = function (size) {
			return Math.floor(Math.random() * size);
		};
		//Мы генерируем случайное число от 0 до 1 с помощью Math.random, умножаем его на аргумент size и затем используем Math.floor для округления до ближайшего снизу целого числа. Далее мы возвращаем полученный результат из функции. Вызов getRandomNumber(400) вернет случайное число от 0 до 399, что нам и требуется.

		//Создать обработчик кликов.
		//Перед тем как писать код обработчика, мы создадим переменные и функции, которые помогут нам запрограммировать нужные действия.
		var clicks = 0;
		//Задаем координаты клада:
		var width = 800;
		var height = 800;
		//переменные width и height, соответствующие ширине и высоте элемента img, который мы используем в качестве карты
		var alowedClicksNumber = 30; //ограничение количества кликов

		// Случайная позиция клада
		var target = {
			x: getRandomNumber(width),
			y: getRandomNumber(height)
		}
		//мы создали объект под названием target с двумя свойствами x и y, обозначающими координаты клада
		//Значения x и y мы получаем из функции getRandomNumber. Каждый раз при запуске этого кода мы получим новую случайную позицию на карте и координаты этой позиции будут сохранены в свойствах x и y переменной target.

		// Вычислить расстояние от клика (event) до клада (target)
		//event — тот же самый, что передается обработчику кликов, и в нем содержится информация о событии: свойства offsetX и offsetY, хранящие x- и y-координаты клика
		//B коде функции переменная diffX хранит горизонтальное расстояние между кликом и кладом, которое мы получаем, вычитая target.x (x-координата клада) из event.offsetX (x-координата клика). Тем же образом мы находим вертикальное расстояние, сохраняя его в переменной diffY. И наконец, чтобы найти расстояние между двумя точками в коде функции getDistance, используется теорема Пифагора.
		//Метод Math.sqrt() возвращает квадратный корень числа
		var getDistance = function (event, target) {
			var diffX = event.offsetX - target.x;
			var diffY = event.offsetY - target.y;
			return Math.sqrt((diffX * diffX) + (diffY * diffY));
		};

		//Сообщаем игроку, насколько он близок к цели or Получить для расстояния строку подсказки
		//Зная расстояние между кликом и кладом, остается отобразить подсказку (hint), которая сообщала бы игроку, насколько близко он подошел, — но без конкретных цифр. Отображать эти сообщения мы будем, задавая их как текстовое содержимое элемента p на нашей странице.
		var getDistanceHint = function (distance) {
			if (distance < 10) {
				return "Обожжешься!";
			} else if (distance < 20) {
				return "Очень горячо";
			} else if (distance < 40) {
				return "Горячо";
			} else if (distance < 80) {
				return "Тепло";
			} else if (distance < 160) {
				return "Холодно";
			} else if (distance < 320) {
				return "Очень холодно";
			} else if (distance < 720) {
				return "Очень-очень холодно!"
			} else {
				return "Замерзнешь!"
			}
		};

		//Код игры
		//Теперь, когда у нас есть все части кода, объединим их в программу.
		//Обработчик кликов — функция, которая будет вызываться каждый раз, когда игрок кликнет по карте.
		// Добавляем элементу img обработчик клика
		$("#map").click(function (event) {
			//Ограничение по кликам
			if (clicks >= alowedClicksNumber) {
				alert("Game over");
				return;
			}

			//Каждый раз, когда игрок кликает по карте, обработчик кликов должен:
			//Увеличиваем счетчик кликов на 1
			clicks++;
			
			//Вычисляем, насколько далеко место клика от места, где спрятан клад
			var distance = getDistance(event, target);

			//Проверка на выигрыш:
			//Поздравить игрока, если он кликнул по кладу или вблизи него, и сообщить, сколько кликов ушло на поиски.
			//Поскольку один пиксель очень мал, мы не будем вынуждать игрока кликать в точности по месту с кладом, а засчитаем за победу клик на расстоянии менее восьми пикселей.
			if (distance < 8) {
				alert("Клад найден! Сделано кликов: " + clicks);
				return;
			}

			// Преобразуем расстояние в подсказку
			var distanceHint = getDistanceHint(distance);

			// Записываем в элемент #distance новую подсказку и отображаем число оставшихся кликов
			var leftAllowedClicks = alowedClicksNumber - clicks;
			
			$("#distance").text(distanceHint + " Осталось кликов: " + leftAllowedClicks);
			
			//Ограничение по кликам
			if (clicks >= alowedClicksNumber) {
				alert("Game over");
				return;
			}
		});
		
		
		
		
	</script>
</body>
</html>
